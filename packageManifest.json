{
    "packageName": "MCP Rule Server",
    "author": "kingpanther13",
    "version": "0.2.6",
    "minimumHEVersion": "2.3.0",
    "dateReleased": "2026-01-25",
    "documentationLink": "https://github.com/kingpanther13/Hubitat-local-MCP-server/blob/main/README.md",
    "communityLink": "",
    "releaseNotes": "v0.2.6 - Added generate_bug_report tool:\n- New generate_bug_report tool for easy GitHub issue submission\n- Gathers system info, recent errors, rule diagnostics automatically\n- Formats into a ready-to-submit GitHub issue with instructions\n- Updated README with complete version history (was missing 0.1.12-0.2.5)\n\nv0.2.5 - Added UI control for MCP debug log level:\n- New 'MCP Debug Log Level' dropdown in Settings (debug/info/warn/error)\n- Setting defaults to 'error' for production (no log spam for regular users)\n- MCP set_log_level tool can change to any level and syncs with UI\n- Fixed version display in app UI (was stuck at 0.1.21)\n\nv0.2.4 - Added version field to get_logging_status:\n- MCP can now check current server version via get_logging_status tool\n- Version field added to response for easy version verification\n\nv0.2.3 - Version bump for HPM release (no code changes from 0.2.2)\n\nv0.2.2 - CRITICAL FIX for rules with enabled=true not persisting data:\n- Root cause: Hubitat's regular state object is only persisted when app execution ends\n- When enabled=true triggers lifecycle methods, a new execution context starts\n- This new context reads stale state from database (data not yet persisted)\n- FIX: Switched all rule data (triggers, conditions, actions, localVariables) to atomicState\n- atomicState persists immediately to database, preventing race condition\n- Added debug logging in updateRuleFromParent to track data flow\n- This definitively fixes the 'enabled=true rules have no triggers/actions' bug\n\nv0.2.1 - Fix duplicate method error:\n- Removed duplicate formatTimestamp method that caused Hubitat compilation error\n- Updated formatTimestamp to use more readable yyyy-MM-dd HH:mm:ss format\n\nv0.2.0 - MCP Debug Logging System & Rule Creation Fix:\n\nNEW FEATURES:\n- Added MCP-accessible debug logging system with 5 new tools:\n  - get_debug_logs: Retrieve recent log entries with filtering by level, component, ruleId\n  - clear_debug_logs: Clear the debug log buffer\n  - get_rule_diagnostics: Get comprehensive diagnostic info about a specific rule\n  - set_log_level: Configure logging threshold (debug/info/warn/error)\n  - get_logging_status: View logging system statistics\n- Debug logs are stored in app state and accessible via MCP (unlike Hubitat's built-in logs)\n- Rule creation now returns diagnostics showing stored trigger/action counts\n- Automatic verification of rule data persistence after creation\n\nBUG FIXES:\n- Fixed rule creation with enabled=true not persisting data (race condition fix)\n  - Root cause: State was being overwritten by Hubitat lifecycle methods\n  - Fix 1: installed() now only initializes state arrays if they don't exist (prevents overwrite)\n  - Fix 2: updateRuleFromParent() now sets ALL state BEFORE any settings (prevents race)\n- Detailed logging of rule creation process for debugging\n\nv0.1.23 - Critical fix for rule creation and robustness improvements:\n- CRITICAL: Fixed rules with enabled=true not persisting triggers/conditions/actions\n  - Root cause: enabled status was set BEFORE data was stored, causing Hubitat lifecycle interference\n  - Now enabled status is set AFTER all rule data is persisted to state\n- Added try-catch wrapper for device_command action execution to prevent rule failures\n- Added null checks for sunrise/sunset in time triggers (prevents NPE at extreme latitudes)\n- Added null checks for sunrise/sunset in sun_position condition evaluation\n- Added sequential execution note to tool descriptions (concurrent MCP calls may cause issues)\n\nv0.1.22 - Major bug fixes from thorough code review:\n- CRITICAL: Fixed if_then_else action - return from nested actions now properly stops rule execution\n- CRITICAL: Fixed repeat action - return from nested actions now properly stops rule execution\n- CRITICAL: Fixed device_was validation - now validates forSeconds field (was incorrectly validating duration)\n- Fixed unschedule in duration triggers - no longer cancels ALL duration timers when one condition becomes false\n- Fixed type coercion bugs - trigger/condition value comparisons now work correctly with 0 and empty strings\n- Fixed buttonNumber comparison - button 0 now works correctly in button event triggers\n- Fixed repeat action validation - now requires times >= 1 (prevents infinite loop with times=0)\n- Fixed null safety in toolListRules - rules with null data no longer cause NPE\n- Fixed operator ordering in illuminance condition UI - now consistent with other numeric comparisons\n- Added mode condition operator validation - validates 'in' and 'not_in' operators\n- Added null check for forSeconds in device_was condition evaluation\n\nv0.1.21 - Bug fixes and validation improvements from code review:\n- Fixed negative index vulnerability in trigger/condition/action editing (6 locations)\n- Fixed hue value coercion bug in restore_state (hue=0 was incorrectly treated as null)\n- Fixed previousMode capture bug in set_mode (was captured after mode change instead of before)\n- Added null safety for mode condition evaluation\n- Added null safety for days_of_week condition evaluation\n- Added null safety for mode and days_of_week description formatting\n- Added enum validation for days_of_week (validates day names)\n- Added enum validation for sun_position (validates up/down)\n- Added enum validation for hsm_status (validates status values)\n- Added validation for negative delay seconds\n- Removed hardcoded capture limit text from UI\n- Made empty conditions text consistent across pages\n\nv0.1.20 - Critical bug fixes found via code review:\n- CRITICAL: Added periodic trigger handler - periodic triggers now actually fire\n- Fixed cancel_delayed action - specific ID cancellation now works correctly\n- Added 7 missing condition types to if_then_else action UI (device_was, presence, lock, thermostat_mode, thermostat_state, illuminance, power)\n- Added handlePeriodicEvent() handler with cron scheduling for minutes/hours/days intervals\n\nv0.1.19 - Fix time_range field name compatibility in MCP validation:\n- MCP now accepts both start/end and startTime/endTime field names for time_range conditions\n- Previously only rule engine accepted old names, but MCP validation rejected them\n\nv0.1.18 - Fix Hubitat sandbox compatibility:\n- Removed expression condition type (Eval.me() not allowed in Hubitat sandbox)\n\nv0.1.17 - UI/MCP parity and validation improvements:\n- Added 6 missing condition types to UI: presence, lock, thermostat_mode, thermostat_state, illuminance, power\n- Added 12 missing action types to UI: set_color, set_color_temperature, lock, unlock, activate_scene, set_local_variable, send_notification, capture_state, restore_state, cancel_delayed, if_then_else, repeat\n- Fixed time_range field name compatibility (now accepts both start/end and startTime/endTime)\n- Fixed conditionLogic persistence (now stored in settings instead of state)\n- Added MCP validation: operator (==,!=,>,<,>=,<=), duration max (2 hours), button actions (pushed/held/doubleTapped/released), time format (HH:mm)\n\nv0.1.16 - Fix duration trigger re-arming and edge cases:\n- Added clearDurationState() to enableRule(), disableRule(), and updateRuleFromParent()\n- Fixed duration triggers not re-arming after rule disable/enable cycle\n- Added bounds validation to getMaxCapturedStates() (min: 1, max: 100) to prevent infinite loops\n- Added missing type specification to set_variable.value parameter\n\nv0.1.15 - Fix required fields validation error on rule creation:\n- Added clearAllSubPageSettings() to clear orphaned trigger/condition/action settings\n- Prevents 'please fill out all required fields' error when sub-page forms were partially filled\n- mainPage now clears all sub-page settings on entry to ensure clean validation state\n\nv0.1.14 - Fix child app label not updating in Hubitat Apps list:\n- Rules created via UI now properly show their name in the Apps list\n- Added app.updateLabel() calls to installed(), updated(), and updateRuleFromParent()\n- Previously UI-created rules showed as 'MCP Rule' instead of the actual rule name\n\nv0.1.13 - Fix Hubitat sandbox compatibility:\n- Removed private/static modifiers not allowed in Hubitat Groovy sandbox\n- Fixed HPM update errors\n\nv0.1.12 - Performance improvements and documentation:\n- Added performance warnings to resource-intensive tools (list_devices, get_device_events, list_rules)\n- Duration triggers now support minutes/hours units with 2-hour max limit\n- Captured states limit now user-configurable (default 20, range 1-100) with automatic cleanup and warnings\n- Added new tools: list_captured_states, delete_captured_state, clear_captured_states\n- Fixed duration timer state accumulation\n- Added Performance Considerations section to README (C7/C8/C8 Pro guidance)\n\nv0.1.11 - Added verification reminders to tool descriptions:\n- All state-changing tools now remind AI to verify changes took effect\n- list_devices reminds AI to verify device names, not guess\n\nv0.1.10 - Fixed device label returning null:\n- send_command and get_attribute now properly return device label in response\n- Captures label before operations to avoid Groovy serialization issues\n\nv0.1.9 - Fixed missing condition type validations:\n- Added validation for: presence, lock, thermostat_mode, thermostat_state, illuminance, power\n- These condition types were documented but validation was missing\n\nv0.1.8 - Fixed duration triggers firing repeatedly:\n- After firing, trigger won't fire again until condition goes FALSE first\n- Prevents repeated triggering while condition stays true\n\nv0.1.7 - Fixed duration-based triggers:\n- device_event triggers with duration now properly wait for condition to stay true\n- Uses runIn() timer that cancels if condition becomes false\n- No longer triggers on every event when duration is specified\n\nv0.1.6 - Fixed repeat action:\n- Now accepts both 'times' and 'count' parameters\n\nv0.1.5 - Fixed capture_state/restore_state:\n- States now stored in parent app so any rule can restore states captured by any other rule\n\nv0.1.4 - Added remaining documented actions:\n- set_color: Set color (hue, saturation, level) on RGB devices\n- set_color_temperature: Set color temperature on CT bulbs\n- lock/unlock: Lock or unlock lock devices\n- capture_state/restore_state: Save and restore device states\n- send_notification: Send push notifications to notification devices\n- repeat: Repeat actions N times\n\nv0.1.3 - Major rule engine fixes:\n- Fixed delay action: now uses runIn() for proper async delays\n- Added variable condition: check local and global variables\n- Added device_was condition: check if device has been in state for X seconds\n- Added presence, lock, thermostat_mode, thermostat_state, illuminance, power conditions\n- Fixed localVariables: now properly passed to rules on create/update\n- Added getVariableValue helper for child apps\n\nv0.1.2 - Fixed missing action types in rule engine:\n- if_then_else: Conditional branching now works\n- cancel_delayed: Cancel pending delayed actions\n- set_local_variable: Set rule-scoped variables\n- activate_scene: Activate scene devices\n\nv0.1.1 - Pagination for list_devices:\n- Added offset/limit parameters to list_devices tool\n- Fixes 'detailed=true' failing over Hubitat Cloud (128KB limit)\n- Use limit=20-30 with detailed=true for cloud access\n- Response now includes total, hasMore, nextOffset for pagination\n\nv0.1.0 - Parent/Child Architecture:\n- Rules are now child apps with isolated settings\n- Fixed settings cross-contamination between rules\n\nv0.0.6 - Fixed trigger/condition/action save flow.\nv0.0.5 - Bug fixes and UI improvements.\nv0.0.4 - Added full Rule Engine UI.\nv0.0.3 - Initial release.",
    "apps": [
        {
            "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
            "name": "MCP Rule Server",
            "namespace": "mcp",
            "location": "https://raw.githubusercontent.com/kingpanther13/Hubitat-local-MCP-server/main/hubitat-mcp-server.groovy",
            "required": true,
            "oauth": true,
            "primary": true
        },
        {
            "id": "b2c3d4e5-f6a7-8901-bcde-f23456789012",
            "name": "MCP Rule",
            "namespace": "mcp",
            "location": "https://raw.githubusercontent.com/kingpanther13/Hubitat-local-MCP-server/main/hubitat-mcp-rule.groovy",
            "required": true,
            "oauth": false,
            "primary": false
        }
    ],
    "drivers": []
}
